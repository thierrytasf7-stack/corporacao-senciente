# [STORY-20260213011130-3] Log Rotator para Workers Python
> **Status:** REVISADO
> **subStatus:** waiting_human_approval
> **Agente Sugerido:** @agente-zero
> **Agente AIOS:** ⚡ @devops (Gage) - GitHub Repository Manager
> **Skill:** `/AIOS:agents:devops`
> **Tipo:** feature
> **Dificuldade:** LOW
> **Prioridade:** Alta
> **Criado em:** 2026-02-13 01:11:30

## Contexto
Workers rodando 24/7 geram gigabytes de logs sem rotacao, enchendo disco e dificultando debug. Rotacao automatica garante que logs recentes estejam sempre disponiveis sem consumir espaco indefinidamente.

## Objetivo
Os workers Python geram logs que crescem indefinidamente. Implementar rotacao automatica de logs com limite de tamanho e retencao configuravel. Usar modulo logging com RotatingFileHandler.

## Responsavel
**⚡ Gage** (GitHub Repository Manager) e o agente AIOS responsavel por esta task.
- **Foco:** CI/CD, git operations, releases, infraestrutura e deploy
- **Invocacao:** `/AIOS:agents:devops`
- **Executor runtime:** `@agente-zero` (worker autonomo que processa a story)

## Arquivos Alvo
- `scripts/`

## Output Esperado
- Arquivo scripts/worker_logger.py com funcao setup_worker_logger(worker_name) exportada
- Logs salvos em logs/{worker_name}.log com rotacao em 5MB e 5 backups
- Workers genesis, zero e aider usando o novo logger ao inves de print direto
- Diretorio logs/ criado automaticamente se nao existir

## Acceptance Criteria
- [?] Modulo de logging configurado com RotatingFileHandler
- [?] Logs rotacionam ao atingir 5MB
- [?] Retencao de 5 arquivos de backup
- [?] Todos os workers usando o novo sistema de logging

## Constraints
- Usar apenas logging stdlib Python (RotatingFileHandler)
- Formato de log: %(asctime)s | %(levelname)s | %(name)s | %(message)s
- Nao quebrar safe_print existente - logger complementa, nao substitui output de terminal
- NAO modificar arquivos fora do escopo listado em Arquivos Alvo
- NAO introduzir dependencias externas sem justificativa
- NAO quebrar funcionalidades existentes

## Instrucoes
1. Criar scripts/worker_logger.py com configuracao de RotatingFileHandler. 2. Configurar maxBytes=5MB e backupCount=5. 3. Integrar nos workers: genesis, zero, aider. 4. Garantir que logs antigos sao limpos automaticamente.

## Exemplo de Referencia
```
import logging
from logging.handlers import RotatingFileHandler
import os

def setup_worker_logger(worker_name: str, log_dir: str = 'logs') -> logging.Logger:
    os.makedirs(log_dir, exist_ok=True)
    logger = logging.getLogger(worker_name)
    logger.setLevel(logging.INFO)
    handler = RotatingFileHandler(
        os.path.join(log_dir, f'{worker_name}.log'),
        maxBytes=5 * 1024 * 1024, backupCount=5
    )
    handler.setFormatter(logging.Formatter(
        '%(asctime)s | %(levelname)s | %(name)s | %(message)s'
    ))
    logger.addHandler(handler)
    return logger
```


## Execution Log
> Executed at: 2026-02-13T01:11:40.296832
> Total targets: 1
> Files checked: 33
> Overall: ALL PASS
> scripts\aider_with_fallback.py: PASS - Python syntax OK
> scripts\aider_worker_engine.py: PASS - Python syntax OK
> scripts\audit-dependencies.py: PASS - Python syntax OK
> scripts\check-diana-status.py: PASS - Python syntax OK
> scripts\gen-audit.py: PASS - Python syntax OK
> scripts\list-diana-procs.py: PASS - Python syntax OK
> scripts\pipeline-validate.py: PASS - Python syntax OK
> scripts\pm2-wrapper.js: PASS - JS/TS syntax OK
> scripts\pm2-wrapper.py: PASS - Python syntax OK
> scripts\qa-explore-routes.js: PASS - JS/TS syntax OK
> scripts\sentinela_escrivao_aider.py: PASS - Python syntax OK
> scripts\sentinela_genesis_saude.py: PASS - Python syntax OK
> scripts\sentinela_revisor_agentezero.py: PASS - Python syntax OK
> scripts\stress-test-20-stories.py: PASS - Python syntax OK
> scripts\stress-test-live.py: PASS - Python syntax OK
> scripts\stress-test-mini.py: PASS - Python syntax OK
> scripts\stress-test-quick.py: PASS - Python syntax OK
> scripts\verificar_sistema.py: PASS - Python syntax OK
> scripts\worker_genesis_agent.py: PASS - Python syntax OK
> scripts\write-audit.js: PASS - JS/TS syntax OK
> scripts\zero_worker_engine.py: PASS - Python syntax OK
> scripts\migration\MigrationState-README.md: PASS - Markdown OK (11783 bytes, has headings)
> scripts\migration\README.md: PASS - Markdown OK (12058 bytes, has headings)
> scripts\migration\TASK-2.1-COMPLETION.md: PASS - Markdown OK (8345 bytes, has headings)
> scripts\migration\TASK-2.2-COMPLETION.md: PASS - Markdown OK (10856 bytes, has headings)
> scripts\migration\docker-cleanup-report.json: PASS - File exists (7785 bytes, no syntax check for .json)
> scripts\migration\inventory.json: PASS - File exists (82490 bytes, no syntax check for .json)
> scripts\migration\sample-inventory-output.json: PASS - File exists (3861 bytes, no syntax check for .json)
> scripts\migration\test-output\container-termination-report.json: PASS - File exists (2357 bytes, no syntax check for .json)
> scripts\migration\test-output\mock-inventory.json: PASS - File exists (417 bytes, no syntax check for .json)
> scripts\migration\test-output\test-inventory.json: PASS - File exists (149 bytes, no syntax check for .json)
> scripts\migration\test-output\test-migration-state.json: PASS - File exists (820 bytes, no syntax check for .json)
> scripts\senciencia\daemon_auto_continue.js: PASS - JS/TS syntax OK
