# [STORY-20260213012354-3] Padronizar Error Handling nos Workers Python
> **Status:** REVISADO
> **subStatus:** waiting_human_approval
> **Agente Sugerido:** @agente-zero
> **Agente AIOS:** ðŸ›ï¸ @architect (Aria) - Architect
> **Skill:** `/AIOS:agents:architect`
> **Tipo:** refactor
> **Dificuldade:** MEDIUM
> **Prioridade:** Alta
> **Criado em:** 2026-02-13 01:23:54

## Contexto
Workers Python sao a espinha dorsal do pipeline autonomo Diana. Erros silenciosos ou mal tratados causam stories travadas no pipeline, exigindo intervencao manual e quebrando a premissa de operacao 24/7.

## Objetivo
Os workers Python em scripts/ tem tratamento de erro inconsistente. Alguns usam try/except generico, outros nao tratam erros. Padronizar com logging estruturado, retry com backoff exponencial e notificacao de falhas criticas.

## Responsavel
**ðŸ›ï¸ Aria** (Architect) e o agente AIOS responsavel por esta task.
- **Foco:** System design, API design, tech stack selection, arquitetura cross-stack
- **Invocacao:** `/AIOS:agents:architect`
- **Executor runtime:** `@agente-zero` (worker autonomo que processa a story)

## Arquivos Alvo
- `scripts/`
- `src/`

## Output Esperado
- Arquivo scripts/worker_utils.py com funcoes retry_with_backoff() e setup_logger()
- Todos os workers (genesis, zero, aider) importando e usando worker_utils
- Zero ocorrencias de except generico (except Exception sem re-raise) nos workers
- Logs estruturados com nivel, timestamp e contexto em cada operacao critica

## Acceptance Criteria
- [?] Todos os workers usando logging estruturado com niveis corretos
- [?] Retry com backoff exponencial em operacoes de I/O
- [?] Erros criticos gerando notificacao no sistema
- [?] Nenhum except generico sem tratamento especifico

## Constraints
- Usar apenas stdlib Python (logging, time, functools) - sem dependencias externas
- Manter compatibilidade com Python 3.10+
- Nao alterar a logica de negocio dos workers, apenas o tratamento de erros
- NAO modificar arquivos fora do escopo listado em Arquivos Alvo
- NAO introduzir dependencias externas sem justificativa
- NAO quebrar funcionalidades existentes

## Instrucoes
1. Mapear todos os scripts Python em scripts/ que sao workers. 2. Criar modulo utilitario scripts/worker_utils.py com funcoes de retry e logging. 3. Refatorar cada worker para usar o modulo utilitario. 4. Substituir except generico por excecoes especificas. 5. Testar cada worker manualmente para garantir funcionamento.

## Exemplo de Referencia
```
import logging
from functools import wraps
import time

def retry_with_backoff(max_retries: int = 3, base_delay: float = 1.0):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except (IOError, OSError) as e:
                    delay = base_delay * (2 ** attempt)
                    logging.warning(f'Retry {attempt+1}/{max_retries} for {func.__name__}: {e}')
                    time.sleep(delay)
            raise
        return wrapper
    return decorator
```


## Execution Log
> Executed at: 2026-02-13T01:25:18.274236
> Total targets: 2
> Files checked: 68
> Overall: ALL PASS
> scripts\aider_with_fallback.py: PASS - Python syntax OK
> scripts\aider_worker_engine.py: PASS - Python syntax OK
> scripts\audit-dependencies.py: PASS - Python syntax OK
> scripts\check-diana-status.py: PASS - Python syntax OK
> scripts\gen-audit.py: PASS - Python syntax OK
> scripts\list-diana-procs.py: PASS - Python syntax OK
> scripts\pipeline-validate.py: PASS - Python syntax OK
> scripts\pm2-wrapper.js: PASS - JS/TS syntax OK
> scripts\pm2-wrapper.py: PASS - Python syntax OK
> scripts\qa-explore-routes.js: PASS - JS/TS syntax OK
> scripts\sentinela_escrivao_aider.py: PASS - Python syntax OK
> scripts\sentinela_genesis_saude.py: PASS - Python syntax OK
> scripts\sentinela_revisor_agentezero.py: PASS - Python syntax OK
> scripts\stress-test-20-stories.py: PASS - Python syntax OK
> scripts\stress-test-live.py: PASS - Python syntax OK
> scripts\stress-test-mini.py: PASS - Python syntax OK
> scripts\stress-test-quick.py: PASS - Python syntax OK
> scripts\verificar_sistema.py: PASS - Python syntax OK
> scripts\worker_genesis_agent.py: PASS - Python syntax OK
> scripts\write-audit.js: PASS - JS/TS syntax OK
> scripts\zero_worker_engine.py: PASS - Python syntax OK
> scripts\migration\MigrationState-README.md: PASS - Markdown OK (11783 bytes, has headings)
> scripts\migration\README.md: PASS - Markdown OK (12058 bytes, has headings)
> scripts\migration\TASK-2.1-COMPLETION.md: PASS - Markdown OK (8345 bytes, has headings)
> scripts\migration\TASK-2.2-COMPLETION.md: PASS - Markdown OK (10856 bytes, has headings)
> scripts\migration\docker-cleanup-report.json: PASS - File exists (7785 bytes, no syntax check for .json)
> scripts\migration\inventory.json: PASS - File exists (82490 bytes, no syntax check for .json)
> scripts\migration\sample-inventory-output.json: PASS - File exists (3861 bytes, no syntax check for .json)
> scripts\migration\test-output\container-termination-report.json: PASS - File exists (2357 bytes, no syntax check for .json)
> scripts\migration\test-output\mock-inventory.json: PASS - File exists (417 bytes, no syntax check for .json)
> scripts\migration\test-output\test-inventory.json: PASS - File exists (149 bytes, no syntax check for .json)
> scripts\migration\test-output\test-migration-state.json: PASS - File exists (820 bytes, no syntax check for .json)
> scripts\senciencia\daemon_auto_continue.js: PASS - JS/TS syntax OK
> src\__init__.py: PASS - Python syntax OK
> src\main.py: PASS - Python syntax OK
> src\auth\middleware\auth_middleware.py: PASS - Python syntax OK
> src\auth\models\user.py: PASS - Python syntax OK
> src\auth\routes\auth.py: PASS - Python syntax OK
> src\auth\services\auth_service.py: PASS - Python syntax OK
> src\components\stories\StoryCard.tsx: PASS - JSX/TSX OK (1562 bytes)
> src\core\ether.py: PASS - Python syntax OK
> src\core\kernel.py: PASS - Python syntax OK
> src\core\logger.py: PASS - Python syntax OK
> src\core\entities\__init__.py: PASS - Python syntax OK
> src\core\entities\holding.py: PASS - Python syntax OK
> src\core\llm\base_agent.py: PASS - Python syntax OK
> src\core\services\auto_subsidiary_creator.py: PASS - Python syntax OK
> src\core\services\data_ingestion_optimizer.py: PASS - Python syntax OK
> src\core\services\infrastructure_provisioning_optimizer.py: PASS - Python syntax OK
> src\core\services\llb_storage_optimizer.py: PASS - Python syntax OK
> src\core\services\realtime_monitoring_dashboard.py: PASS - Python syntax OK
> src\core\services\revenue_sharing_system.py: PASS - Python syntax OK
> src\core\value_objects\__init__.py: PASS - Python syntax OK
> src\core\value_objects\agent_role.py: PASS - Python syntax OK
> src\core\value_objects\business_type.py: PASS - Python syntax OK
> src\core\value_objects\llb_protocol.py: PASS - Python syntax OK
> src\core\value_objects\market_opportunity.py: PASS - Python syntax OK
> src\core\value_objects\revenue_model.py: PASS - Python syntax OK
> src\hooks\use-monitor-events.ts: PASS - JS/TS syntax OK
> src\infrastructure\database\__init__.py: PASS - Python syntax OK
> src\infrastructure\database\connection.py: PASS - Python syntax OK
> src\infrastructure\database\repository.py: PASS - Python syntax OK
> src\infrastructure\monitoring\alert_rules.yml: PASS - File exists (7325 bytes, no syntax check for .yml)
> src\infrastructure\monitoring\metrics_collector.py: PASS - Python syntax OK
> src\infrastructure\monitoring\prometheus.yml: PASS - File exists (1708 bytes, no syntax check for .yml)
> src\presentation\api\main.py: PASS - Python syntax OK
> src\stores\monitor-store.ts: PASS - JS/TS syntax OK
> src\stores\settings-store.ts: PASS - JS/TS syntax OK
