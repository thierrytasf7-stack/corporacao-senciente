# [STORY-20260213012355-4] Migrar Scripts PowerShell para Python Cross-Platform
> **Status:** REVISADO
> **subStatus:** waiting_human_approval
> **Agente Sugerido:** @aider
> **Agente AIOS:** ⚡ @devops (Gage) - GitHub Repository Manager
> **Skill:** `/AIOS:agents:devops`
> **Tipo:** refactor
> **Dificuldade:** HARD
> **Prioridade:** Alta
> **Criado em:** 2026-02-13 01:23:55

## Contexto
Dependencia exclusiva de PowerShell limita o sistema Diana ao Windows. Migrar scripts essenciais para Python remove essa restricao, permitindo execucao em Linux/Mac para desenvolvimento e potencial deploy multi-plataforma.

## Objetivo
Varios scripts operacionais estao em PowerShell (.ps1) que so rodam no Windows. Migrar os scripts essenciais para Python para permitir execucao cross-platform e melhor integracao com o pipeline de workers.

## Responsavel
**⚡ Gage** (GitHub Repository Manager) e o agente AIOS responsavel por esta task.
- **Foco:** CI/CD, git operations, releases, infraestrutura e deploy
- **Invocacao:** `/AIOS:agents:devops`
- **Executor runtime:** `@aider` (worker autonomo que processa a story)

## Arquivos Alvo
- `scripts/`

## Output Esperado
- Versoes Python de check-diana-status.ps1, list-diana-procs.ps1 e check-ports.ps1
- Cada script Python com funcionalidade equivalente verificada manualmente
- Deteccao automatica de plataforma (os.name) para adaptar comandos
- Scripts .ps1 originais mantidos sem alteracao como fallback

## Acceptance Criteria
- [?] Scripts essenciais de monitoramento migrados para Python
- [?] Funcionalidade equivalente ao PowerShell original
- [?] Compativel com Windows e Linux
- [?] Scripts PowerShell originais mantidos como fallback

## Constraints
- Usar subprocess e os stdlib - psutil opcional (verificar se esta instalado com try/import)
- Manter mesma interface de output (formato de tabela, exit codes) do PowerShell original
- Nao remover scripts .ps1 originais - coexistencia obrigatoria
- NAO modificar arquivos fora do escopo listado em Arquivos Alvo
- NAO introduzir dependencias externas sem justificativa
- NAO quebrar funcionalidades existentes

## Instrucoes
1. Listar scripts .ps1 essenciais em scripts/ (check-diana-status, list-diana-procs). 2. Criar versao Python equivalente para cada um. 3. Usar subprocess e psutil para equivalencia com Get-Process e Get-Service. 4. Manter .ps1 originais e adicionar .py como alternativa.

## Exemplo de Referencia
```
import subprocess
import os
import sys

def get_running_processes(filter_name: str = 'diana') -> list[dict]:
    if os.name == 'nt':  # Windows
        result = subprocess.run(
            ['tasklist', '/FI', f'IMAGENAME eq {filter_name}*', '/FO', 'CSV'],
            capture_output=True, text=True
        )
    else:  # Linux/Mac
        result = subprocess.run(
            ['ps', 'aux'], capture_output=True, text=True
        )
    return parse_process_output(result.stdout)

def parse_process_output(output: str) -> list[dict]:
    lines = output.strip().split('\n')
    return [{'name': l.split(',')[0].strip('"')} for l in lines[1:] if l]
```


## Review Results
> Reviewed at: 2026-02-13T01:29:36.419759
> Verdict: FAIL
> Aider log present: False
> Aider result: None
> Files modified by Aider: 0
> All syntax OK: True
> scripts\aider_with_fallback.py: PASS - Python syntax OK
> scripts\aider_worker_engine.py: PASS - Python syntax OK
> scripts\audit-dependencies.py: PASS - Python syntax OK
> scripts\check-diana-status.py: PASS - Python syntax OK
> scripts\gen-audit.py: PASS - Python syntax OK
> scripts\list-diana-procs.py: PASS - Python syntax OK
> scripts\pipeline-validate.py: PASS - Python syntax OK
> scripts\pm2-wrapper.js: PASS - JS/TS syntax OK
> scripts\pm2-wrapper.py: PASS - Python syntax OK
> scripts\qa-explore-routes.js: PASS - JS/TS syntax OK
> scripts\sentinela_escrivao_aider.py: PASS - Python syntax OK
> scripts\sentinela_genesis_saude.py: PASS - Python syntax OK
> scripts\sentinela_revisor_agentezero.py: PASS - Python syntax OK
> scripts\stress-test-20-stories.py: PASS - Python syntax OK
> scripts\stress-test-live.py: PASS - Python syntax OK
> scripts\stress-test-mini.py: PASS - Python syntax OK
> scripts\stress-test-quick.py: PASS - Python syntax OK
> scripts\verificar_sistema.py: PASS - Python syntax OK
> scripts\worker_genesis_agent.py: PASS - Python syntax OK
> scripts\write-audit.js: PASS - JS/TS syntax OK
> scripts\zero_worker_engine.py: PASS - Python syntax OK
> scripts\migration\MigrationState-README.md: PASS - Markdown OK (11783 bytes, has headings)
> scripts\migration\README.md: PASS - Markdown OK (12058 bytes, has headings)
> scripts\migration\TASK-2.1-COMPLETION.md: PASS - Markdown OK (8345 bytes, has headings)
> scripts\migration\TASK-2.2-COMPLETION.md: PASS - Markdown OK (10856 bytes, has headings)
> scripts\migration\docker-cleanup-report.json: PASS - File exists (7785 bytes, no syntax check for .json)
> scripts\migration\inventory.json: PASS - File exists (82490 bytes, no syntax check for .json)
> scripts\migration\sample-inventory-output.json: PASS - File exists (3861 bytes, no syntax check for .json)
> scripts\migration\test-output\container-termination-report.json: PASS - File exists (2357 bytes, no syntax check for .json)
> scripts\migration\test-output\mock-inventory.json: PASS - File exists (417 bytes, no syntax check for .json)
> scripts\migration\test-output\test-inventory.json: PASS - File exists (149 bytes, no syntax check for .json)
> scripts\migration\test-output\test-migration-state.json: PASS - File exists (820 bytes, no syntax check for .json)
> scripts\senciencia\daemon_auto_continue.js: PASS - JS/TS syntax OK

## Aider Processing Log
- **Timestamp:** 2026-02-13 01:31:06
- **Duration:** 120.4s
- **Result:** FAILED
- **Error:** Exit code 1


## Review Results
> Reviewed at: 2026-02-13T01:31:09.409526
> Verdict: FAIL
> Aider log present: True
> Aider result: FAILED
> Files modified by Aider: 0
> All syntax OK: False
> Aider reported FAILED
