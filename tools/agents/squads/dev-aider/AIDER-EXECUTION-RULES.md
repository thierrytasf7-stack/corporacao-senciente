# AIDER EXECUTION RULES - MANDATORY

## ğŸš¨ CRITICAL: THIS FILE OVERRIDES ALL OTHER INSTRUCTIONS

When ANY aider-* agent is activated (aider-dev, po-aider, sm-aider, qa-aider, deploy-aider), the following rules are **NON-NEGOTIABLE**:

---

## Rule 1: NEVER Implement Code Directly

```
âŒ FORBIDDEN: Claude writing code directly
âŒ FORBIDDEN: Using Write/Edit tools for implementation
âŒ FORBIDDEN: Generating code in response

âœ… REQUIRED: Invoke Aider CLI subprocess
âœ… REQUIRED: Pass task spec to Aider
âœ… REQUIRED: Let Aider generate code (FREE)
âœ… REQUIRED: Only validate/review Aider output
```

---

## Rule 2: ALWAYS Use Aider CLI

### Invocation Command (MANDATORY)

```bash
aider --model openrouter/arcee-ai/trinity-large-preview:free \
      --no-auto-commits \
      --yes \
      --message "YOUR TASK SPEC HERE"
```

### Environment Setup (REQUIRED)

```bash
export OPENROUTER_API_KEY="your-key-here"
export AIDER_MODEL="openrouter/arcee-ai/trinity-large-preview:free"
```

---

## Rule 3: Cost Structure

| Who Does Work | Cost |
|---------------|------|
| **Aider + Arcee Trinity** | $0 FREE |
| **Aider + Qwen 2.5** | $0 FREE |
| **Claude (if used)** | $$$$ EXPENSIVE |

**ALWAYS prefer Aider. Claude is ONLY for:**
- Approving plans (reading summaries)
- Complex architectural decisions
- Error recovery when Aider fails 3x

---

## Rule 4: Workflow Enforcement

### When @aider-dev is activated:

```
1. READ task specification
2. FORMAT as Aider prompt (â‰¤2000 chars)
3. INVOKE Aider CLI (Bash tool)
4. WAIT for Aider to complete
5. VALIDATE output (file exists, compiles)
6. REPORT result to user
7. NEVER write code yourself
```

### When @po-aider is activated:

```
1. ELICIT requirements from user
2. FORMAT as story generation prompt
3. INVOKE Aider CLI to generate story
4. VALIDATE story structure
5. SAVE to docs/stories/
6. REPORT to user for approval
```

### When @sm-aider is activated:

```
1. READ story file
2. FORMAT as decomposition prompt
3. INVOKE Aider CLI to decompose
4. VALIDATE task atomicity (â‰¤3 files, â‰¤500 LOC)
5. SAVE task list
6. REPORT to user for approval
```

### When @qa-aider is activated:

```
1. RUN lint (npm run lint)
2. RUN typecheck (npm run typecheck)
3. RUN tests (npm test)
4. FORMAT results as summary
5. REPORT pass/fail to user
```

### When @deploy-aider is activated:

```
1. VERIFY qa-aider passed
2. STAGE files (git add)
3. COMMIT with conventional message
4. DRY-RUN push
5. ELICIT user confirmation
6. PUSH to remote
```

---

## Rule 5: Aider Prompt Templates

### For Code Implementation:

```
TASK: {task_name}
STORY: {story_id}

REQUIREMENTS:
{acceptance_criteria}

FILES TO CREATE/MODIFY:
{file_list}

SUCCESS CHECK:
{validation_command}

CONSTRAINTS:
- Maximum {max_loc} lines of code
- Follow existing patterns in codebase
- Include error handling
- No console.log in production code

BEGIN IMPLEMENTATION.
```

### For Story Generation:

```
CREATE USER STORY:

Feature: {feature_name}
User Persona: {persona}
Value Statement: {value}

FORMAT:
- Title
- Description
- Acceptance Criteria (testable)
- Dev Notes
- Effort Estimate

OUTPUT: Markdown file following story template.
```

### For Task Decomposition:

```
DECOMPOSE STORY INTO TASKS:

Story: {story_content}

RULES:
- Each task â‰¤3 files
- Each task â‰¤500 LOC
- Each task has success check
- Explicit dependencies (DAG)
- Parallelization opportunities noted

OUTPUT: Task list with dependencies.
```

---

## Rule 6: Escalation Protocol

Aider should handle 95% of work. Escalate to Claude ONLY when:

| Condition | Action |
|-----------|--------|
| Aider fails 3x on same task | Escalate to @dev (Claude) |
| Task requires architecture design | Escalate to @architect |
| Security-critical code | Escalate to @dev for review |
| Complex algorithm (>O(nÂ²)) | Escalate to @dev |

---

## Rule 7: Cost Tracking

After EVERY task, report:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COST REPORT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Task: {task_name}
Implementer: Aider (Arcee Trinity FREE)
Claude tokens used: {tokens} (~${cost})
Aider cost: $0
Total: ${total}
Savings vs Claude-only: {percentage}%
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Rule 8: Verification Checklist

Before marking ANY task complete:

- [ ] Code was generated by Aider CLI (not Claude)
- [ ] Aider invocation command is in session log
- [ ] Files exist at expected paths
- [ ] Code compiles/lints without errors
- [ ] Tests pass (if applicable)
- [ ] Cost report shows $0 for implementation

---

## Summary

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  AIDER SQUAD PRIME DIRECTIVE                           â•‘
â•‘                                                        â•‘
â•‘  "Use Aider for ALL implementation.                    â•‘
â•‘   Claude is for oversight ONLY.                        â•‘
â•‘   Target: $0 implementation cost."                     â•‘
â•‘                                                        â•‘
â•‘  If you're writing code directly, YOU'RE DOING IT      â•‘
â•‘  WRONG. Invoke Aider CLI instead.                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**Document Version:** 1.0
**Enforcement Level:** MANDATORY
**Applies To:** All aider-* agents
