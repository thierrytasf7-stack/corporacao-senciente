{
  "id": "impl-phase1-task4-websocket-reconnect",
  "agent": "dev",
  "task_type": "implement-reliability-fix",
  "model": "arcee-ai/trinity-large-preview:free",
  "tools_required": ["file_read", "file_write", "shell_exec"],
  "aios_guide_path": ".aios-core/development/agents/dev.md",
  "context_files": [
    "modules/betting-platform/frontend/src/main.tsx",
    "modules/betting-platform/frontend/package.json"
  ],
  "prompt": "CRITICAL FIX #4: Implement WebSocket reconnection with exponential backoff\n\nISSUE: WebSocket connection instability - sem reconnect logic\nRISK: Live odds updates stop, user pode apostar em odds desatualizadas\n\nIMPLEMENTATION:\n1. Criar WebSocketManager class com state machine:\n   - States: CONNECTING, CONNECTED, RECONNECTING, DISCONNECTED\n   - Events: connect, disconnect, error, message\n2. Implement exponential backoff:\n   - Initial delay: 1s\n   - Max delay: 30s\n   - Backoff multiplier: 2x\n   - Max attempts: indefinite (while tab active)\n3. Add connection health checks:\n   - Heartbeat ping every 30s\n   - Pong timeout: 10s\n   - Auto-reconnect se timeout\n4. Preserve message queue durante reconnect:\n   - Buffer messages enquanto RECONNECTING\n   - Replay quando CONNECTED\n5. Add visual indicator:\n   - Badge \"Live\" (verde) quando CONNECTED\n   - Badge \"Reconnecting...\" (amarelo) quando RECONNECTING\n   - Badge \"Offline\" (vermelho) quando DISCONNECTED\n6. Add event listeners:\n   - window.addEventListener('online', reconnect)\n   - document.addEventListener('visibilitychange', reconnect)\n\nACCEPTANCE CRITERIA:\n- WebSocketManager com state machine\n- Exponential backoff (1s â†’ 30s max)\n- Heartbeat ping/pong implementado\n- Message queue durante reconnect\n- Visual indicator no UI\n- Network change listeners\n\nOUTPUT: WebSocketManager + UI integration + tests",
  "acceptance_criteria": [
    "WebSocketManager class com FSM (CONNECTING/CONNECTED/RECONNECTING/DISCONNECTED)",
    "Exponential backoff: 1s inicial, 2x multiplier, 30s max",
    "Heartbeat ping/pong a cada 30s",
    "Message queue buffer durante reconnect",
    "Visual indicator (Live/Reconnecting/Offline)",
    "Network/visibility change listeners"
  ],
  "max_tool_iterations": 15,
  "self_review": true,
  "quality_threshold": 8
}
